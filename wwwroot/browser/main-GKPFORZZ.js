import{a as se,c as pe,d as le,f as ce,g as ue,h as de}from"./chunk-ORHIZ2KN.js";import"./chunk-5GC77CUC.js";import{a as ae}from"./chunk-QC44KA67.js";import{a as M}from"./chunk-O66JSED4.js";import{h as he}from"./chunk-YHMOLQY4.js";import"./chunk-XHV6DCF3.js";import"./chunk-NROGR6IW.js";import{a as J,d as te,h as ne,i as re,j as oe,l as O}from"./chunk-N35TVY3C.js";import{a as ie}from"./chunk-GT7YEPYQ.js";import{$ as G,$a as Z,B as m,H as h,I as V,J as W,Ja as k,K as g,L as x,N as y,Q as H,R as I,Rb as Y,S as s,T as B,Va as $,a as j,bb as A,e as E,ea as z,f,fc as q,gc as ee,ha as K,ia as R,ib as Q,jb as P,kb as w,lb as _,o as d,rb as N,v as L,w as l,x as c,zb as X}from"./chunk-TWVQ6WYG.js";var ge=[{path:"",loadComponent:()=>import("./chunk-ECWUO46W.js").then(e=>e.HomeComponent)},{path:"qobuz",loadChildren:()=>import("./chunk-SFCY35MZ.js").then(e=>e.QOBUZ_ROUTES)},{path:"tunein",loadComponent:()=>import("./chunk-6VFGNOZC.js").then(e=>e.TuneInComponent)},{path:"radioparadise",loadComponent:()=>import("./chunk-4RQ6FPZB.js").then(e=>e.RadioParadiseComponent)},{path:"players",loadComponent:()=>import("./chunk-2I6CQAA3.js").then(e=>e.PlayersComponent)},{path:"settings",loadComponent:()=>import("./chunk-LI7ZQSHH.js").then(e=>e.SettingsComponent)},{path:"**",redirectTo:""}];var fe=(e,n)=>{if(!e.url.includes("/Qobuz")&&!e.url.includes("/api/qobuz"))return n(e);let o=s(O).getAuthHeaders();if(!o["X-Auth-Token"]||e.headers.has("X-Auth-Token"))return n(e);let t=e.clone({setHeaders:o});return n(t)};var U="Service workers are disabled or not supported by this browser",v=class{serviceWorker;worker;registration;events;constructor(n,r){if(this.serviceWorker=n,!n)this.worker=this.events=this.registration=new E(o=>o.error(new g(5601,!1)));else{let o=null,t=new f;this.worker=new E(p=>(o!==null&&p.next(o),t.subscribe(C=>p.next(C))));let a=()=>{let{controller:p}=n;p!==null&&(o=p,t.next(o))};n.addEventListener("controllerchange",a),a(),this.registration=this.worker.pipe(h(()=>n.getRegistration().then(p=>{if(!p)throw new g(5601,!1);return p})));let i=new f;this.events=i.asObservable();let u=p=>{let{data:C}=p;C?.type&&i.next(C)};n.addEventListener("message",u),r?.get(A,null,{optional:!0})?.onDestroy(()=>{n.removeEventListener("controllerchange",a),n.removeEventListener("message",u)})}}postMessage(n,r){return new Promise(o=>{this.worker.pipe(m(1)).subscribe(t=>{t.postMessage(j({action:n},r)),o()})})}postMessageWithOperation(n,r,o){let t=this.waitForOperationCompleted(o),a=this.postMessage(n,r);return Promise.all([a,t]).then(([,i])=>i)}generateNonce(){return Math.round(Math.random()*1e7)}eventsOfType(n){let r;return typeof n=="string"?r=o=>o.type===n:r=o=>n.includes(o.type),this.events.pipe(c(r))}nextEventOfType(n){return this.eventsOfType(n).pipe(m(1))}waitForOperationCompleted(n){return new Promise((r,o)=>{this.eventsOfType("OPERATION_COMPLETED").pipe(c(t=>t.nonce===n),m(1),d(t=>{if(t.result!==void 0)return t.result;throw new Error(t.error)})).subscribe({next:r,error:o})})}get isEnabled(){return!!this.serviceWorker}},Se=(()=>{class e{sw;messages;notificationClicks;notificationCloses;pushSubscriptionChanges;subscription;get isEnabled(){return this.sw.isEnabled}pushManager=null;subscriptionChanges=new f;constructor(r){if(this.sw=r,!r.isEnabled){this.messages=l,this.notificationClicks=l,this.notificationCloses=l,this.pushSubscriptionChanges=l,this.subscription=l;return}this.messages=this.sw.eventsOfType("PUSH").pipe(d(t=>t.data)),this.notificationClicks=this.sw.eventsOfType("NOTIFICATION_CLICK").pipe(d(t=>t.data)),this.notificationCloses=this.sw.eventsOfType("NOTIFICATION_CLOSE").pipe(d(t=>t.data)),this.pushSubscriptionChanges=this.sw.eventsOfType("PUSH_SUBSCRIPTION_CHANGE").pipe(d(t=>t.data)),this.pushManager=this.sw.registration.pipe(d(t=>t.pushManager));let o=this.pushManager.pipe(h(t=>t.getSubscription()));this.subscription=new E(t=>{let a=o.subscribe(t),i=this.subscriptionChanges.subscribe(t);return()=>{a.unsubscribe(),i.unsubscribe()}})}requestSubscription(r){if(!this.sw.isEnabled||this.pushManager===null)return Promise.reject(new Error(U));let o={userVisibleOnly:!0},t=this.decodeBase64(r.serverPublicKey.replace(/_/g,"/").replace(/-/g,"+")),a=new Uint8Array(new ArrayBuffer(t.length));for(let i=0;i<t.length;i++)a[i]=t.charCodeAt(i);return o.applicationServerKey=a,new Promise((i,u)=>{this.pushManager.pipe(h(b=>b.subscribe(o)),m(1)).subscribe({next:b=>{this.subscriptionChanges.next(b),i(b)},error:u})})}unsubscribe(){if(!this.sw.isEnabled)return Promise.reject(new Error(U));let r=o=>{if(o===null)throw new g(5602,!1);return o.unsubscribe().then(t=>{if(!t)throw new g(5603,!1);this.subscriptionChanges.next(null)})};return new Promise((o,t)=>{this.subscription.pipe(m(1),h(r)).subscribe({next:o,error:t})})}decodeBase64(r){return atob(r)}static \u0275fac=function(o){return new(o||e)(I(v))};static \u0275prov=y({token:e,factory:e.\u0275fac})}return e})(),F=(()=>{class e{sw;versionUpdates;unrecoverable;get isEnabled(){return this.sw.isEnabled}ongoingCheckForUpdate=null;constructor(r){if(this.sw=r,!r.isEnabled){this.versionUpdates=l,this.unrecoverable=l;return}this.versionUpdates=this.sw.eventsOfType(["VERSION_DETECTED","VERSION_INSTALLATION_FAILED","VERSION_READY","NO_NEW_VERSION_DETECTED"]),this.unrecoverable=this.sw.eventsOfType("UNRECOVERABLE_STATE")}checkForUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(U));if(this.ongoingCheckForUpdate)return this.ongoingCheckForUpdate;let r=this.sw.generateNonce();return this.ongoingCheckForUpdate=this.sw.postMessageWithOperation("CHECK_FOR_UPDATES",{nonce:r},r).finally(()=>{this.ongoingCheckForUpdate=null}),this.ongoingCheckForUpdate}activateUpdate(){if(!this.sw.isEnabled)return Promise.reject(new g(5601,!1));let r=this.sw.generateNonce();return this.sw.postMessageWithOperation("ACTIVATE_UPDATE",{nonce:r},r)}static \u0275fac=function(o){return new(o||e)(I(v))};static \u0275prov=y({token:e,factory:e.\u0275fac})}return e})(),be=new H("");function Ce(){let e=s(S);if(!("serviceWorker"in navigator&&e.enabled!==!1))return;let n=s(be),r=s(z),o=s(A);r.runOutsideAngular(()=>{let t=navigator.serviceWorker,a=()=>t.controller?.postMessage({action:"INITIALIZE"});t.addEventListener("controllerchange",a),o.onDestroy(()=>{t.removeEventListener("controllerchange",a)})}),r.runOutsideAngular(()=>{let t,{registrationStrategy:a}=e;if(typeof a=="function")t=new Promise(i=>a().subscribe(()=>i()));else{let[i,...u]=(a||"registerWhenStable:30000").split(":");switch(i){case"registerImmediately":t=Promise.resolve();break;case"registerWithDelay":t=me(+u[0]||0);break;case"registerWhenStable":t=Promise.race([o.whenStable(),me(+u[0])]);break;default:throw new g(5600,!1)}}t.then(()=>{o.destroyed||navigator.serviceWorker.register(n,{scope:e.scope,updateViaCache:e.updateViaCache,type:e.type}).catch(i=>console.error(x(5604,!1)))})})}function me(e){return new Promise(n=>setTimeout(n,e))}function Ee(){let e=s(S),n=s(G),r=!0;return new v(r&&e.enabled!==!1?navigator.serviceWorker:void 0,n)}var S=class{enabled;updateViaCache;type;scope;registrationStrategy};function ye(e,n={}){return B([Se,F,{provide:be,useValue:e},{provide:S,useValue:n},{provide:v,useFactory:Ee},Z(Ce)])}var we={providers:[K(),ne(ge,re(),oe()),q(ee([fe])),ye("ngsw-worker.js",{enabled:!Y(),registrationStrategy:"registerWhenStable:30000"})]};var T=class e{bluesoundApi=s(ae);playerState=s(M);destroy$=new f;pollingSubscription;POLLING_INTERVAL=1e3;isPolling=R(!1);lastPoll=R(null);startPolling(){this.stopPolling(),this.isPolling.set(!0),this.pollingSubscription=L(this.POLLING_INTERVAL).pipe(V(this.destroy$),c(()=>this.playerState.playerMode()==="bluesound"),c(()=>!!this.playerState.selectedPlayer()),h(()=>{let n=this.playerState.selectedPlayer();return n?this.bluesoundApi.getStatus(n.ipAddress):[]}),W(()=>this.lastPoll.set(new Date))).subscribe(n=>{n&&this.playerState.updatePlaybackStatus(n)})}stopPolling(){this.pollingSubscription&&(this.pollingSubscription.unsubscribe(),this.pollingSubscription=void 0),this.isPolling.set(!1)}pollOnce(){let n=this.playerState.selectedPlayer();n&&this.bluesoundApi.getStatus(n.ipAddress).subscribe(r=>{r&&this.playerState.updatePlaybackStatus(r),this.lastPoll.set(new Date)})}refreshPlayers(){this.bluesoundApi.refreshPlayers().subscribe(n=>{this.playerState.players.set(n)})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),this.stopPolling()}static \u0275fac=function(r){return new(r||e)};static \u0275prov=y({token:e,factory:e.\u0275fac,providedIn:"root"})};var D=class e{auth=s(O);playerState=s(M);polling=s(T);swUpdate=s(F);navState=s(ie);ngOnInit(){this.auth.authToken()&&this.auth.verifyToken().subscribe(),this.setupServiceWorkerUpdates()}setupServiceWorkerUpdates(){this.swUpdate.isEnabled&&(this.swUpdate.checkForUpdate().catch(()=>{}),setInterval(()=>{this.swUpdate.checkForUpdate().catch(()=>{})},3e4),this.swUpdate.versionUpdates.pipe(c(n=>n.type==="VERSION_READY")).subscribe(()=>{console.log("New version available, reloading..."),document.location.reload()}))}toggleHamburger(){this.navState.toggleHamburger()}static \u0275fac=function(r){return new(r||e)};static \u0275cmp=$({type:e,selectors:[["app-root"]],decls:10,vars:5,consts:[[1,"app-container","min-h-screen","bg-bg-primary"],[3,"toggleMenu"],[3,"closed","externalOpen"],[1,"flex-1","pb-24","overflow-y-auto"]],template:function(r,o){r&1&&(P(0,"div",0)(1,"app-header",1),N("toggleMenu",function(){return o.toggleHamburger()}),w(),P(2,"app-hamburger-menu",2),N("closed",function(){return o.navState.closeHamburger()}),w(),P(3,"main",3),_(4,"router-outlet"),w(),_(5,"app-global-player")(6,"app-now-playing-popup")(7,"app-fab-menu")(8,"app-volume-panel")(9,"app-global-context-menu"),w()),r&2&&(k(2),Q("externalOpen",o.navState.hamburgerOpen()),k(),X("pt-14",!o.navState.headerConfig().hidden)("header-padding",!o.navState.headerConfig().hidden))},dependencies:[te,se,pe,le,ce,ue,de,he],styles:[".app-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100vh;height:100dvh;overflow:hidden}main[_ngcontent-%COMP%]{flex:1;overflow-y:auto;-webkit-overflow-scrolling:touch}main.header-padding[_ngcontent-%COMP%]{padding-top:calc(3.5rem + env(safe-area-inset-top,0))}"]})};J(D,we).catch(e=>console.error(e));
