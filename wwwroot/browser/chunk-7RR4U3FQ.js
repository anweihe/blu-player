import{b as q}from"./chunk-AT4K7DUL.js";import"./chunk-XHV6DCF3.js";import{g as k}from"./chunk-NROGR6IW.js";import{c as A,e as P}from"./chunk-N35TVY3C.js";import{a as z}from"./chunk-GT7YEPYQ.js";import{$b as T,Bb as c,Cb as S,Db as F,Ja as a,Kb as I,S as g,Va as D,X as _,Y as x,Z as M,_ as w,db as b,eb as f,fb as O,gb as m,hb as h,ia as s,ib as v,jb as r,kb as o,lb as p,pb as C,rb as y,tb as u,zb as E}from"./chunk-TWVQ6WYG.js";var $=()=>[1,2,3,4,5,6,7,8,9,10],N=(i,e)=>e.value,L=(i,e)=>e.id;function j(i,e){if(i&1&&(r(0,"span",5),c(1),o()),i&2){let t=u();a(),S(t.artistName())}}function G(i,e){if(i&1){let t=C();r(0,"button",15),y("click",function(){let d=_(t).$implicit,l=u();return x(l.setFilter(d.value))}),c(1),o()}if(i&2){let t=e.$implicit,n=u();E("bg-accent-qobuz",n.currentFilter()===t.value)("text-white",n.currentFilter()===t.value)("border-accent-qobuz",n.currentFilter()===t.value)("bg-transparent",n.currentFilter()!==t.value)("text-text-secondary",n.currentFilter()!==t.value)("border-border-accent",n.currentFilter()!==t.value)("hover:bg-bg-card",n.currentFilter()!==t.value)("hover:text-text-primary",n.currentFilter()!==t.value),a(),F(" ",t.label," ")}}function Y(i,e){if(i&1&&(r(0,"option",11),c(1),o()),i&2){let t=e.$implicit;v("value",t.value),a(),S(t.label)}}function B(i,e){i&1&&(r(0,"div",16),p(1,"div",17),r(2,"div",18),p(3,"div",19)(4,"div",20),o()())}function Q(i,e){i&1&&(r(0,"div",13),m(1,B,5,0,"div",16,O),o()),i&2&&(a(),h(I(0,$)))}function Z(i,e){i&1&&(r(0,"div",14),M(),r(1,"svg",21),p(2,"path",22),o(),w(),r(3,"p",23),c(4,"Keine Ver\xF6ffentlichungen in dieser Kategorie"),o()())}function H(i,e){if(i&1){let t=C();r(0,"app-album-card",27),y("play",function(){let d=_(t).$implicit,l=u(2);return x(l.playAlbum(d))}),o()}if(i&2){let t=e.$implicit;v("album",t)("showYear",!0)}}function K(i,e){i&1&&(r(0,"div",25),p(1,"div",28),r(2,"span"),c(3,"Lade weitere Alben..."),o()())}function U(i,e){if(i&1&&(r(0,"div",13),m(1,H,1,2,"app-album-card",24,L),o(),b(3,K,4,0,"div",25),p(4,"div",26,0)),i&2){let t=u();a(),h(t.albums()),a(2),f(t.loadingMore()?3:-1)}}var J=[{value:null,label:"Alle"},{value:"album",label:"Alben"},{value:"epSingle",label:"EPs & Singles"},{value:"live",label:"Live"},{value:"compilation",label:"Compilations"},{value:"other",label:"Andere"}],W=[{value:"release_date",label:"Erscheinungsdatum"},{value:"relevant",label:"Beliebtheit"}];function X(i){return i?{single:"epSingle",ep:"epSingle","ep-single":"epSingle",ep_single:"epSingle",epSingle:"epSingle",album:"album",live:"live",compilation:"compilation",other:"other"}[i]??i:null}var R=class i{id;qobuzApi=g(k);navState=g(z);route=g(A);router=g(P);loading=s(!0);loadingMore=s(!1);albums=s([]);artistName=s(void 0);artistImage=s(void 0);hasMore=s(!0);currentFilter=s(null);currentSort=s("release_date");filters=J;sortOptions=W;offset=0;PAGE_SIZE=20;scrollObserver=null;ngOnInit(){document.querySelector("main")?.scrollTo(0,0),this.navState.enterDetailMode(`/qobuz/artist/${this.id}`,"Diskografie"),this.route.queryParams.subscribe(e=>{if(e.type){let t=X(e.type);this.currentFilter.set(t)}}),this.id&&(this.loadArtistInfo(),this.loadDiscography(!0)),setTimeout(()=>this.setupScrollObserver(),100)}ngOnDestroy(){this.navState.exitDetailMode(),this.cleanupScrollObserver()}setupScrollObserver(){let e=document.querySelector(".scroll-sentinel");e&&(this.cleanupScrollObserver(),this.scrollObserver=new IntersectionObserver(t=>{t[0].isIntersecting&&this.hasMore()&&!this.loadingMore()&&!this.loading()&&this.loadMore()},{rootMargin:"200px"}),this.scrollObserver.observe(e))}cleanupScrollObserver(){this.scrollObserver&&(this.scrollObserver.disconnect(),this.scrollObserver=null)}loadArtistInfo(){let e=parseInt(this.id,10);this.qobuzApi.getArtistPage(e).subscribe({next:t=>{this.artistName.set(t.artist?.name),this.artistImage.set(t.artist?.portraitUrl)}})}loadDiscography(e=!1){if(this.loadingMore()||!this.hasMore()&&!e)return;e?(this.loading.set(!0),this.offset=0):this.loadingMore.set(!0);let t=parseInt(this.id,10),n=this.currentFilter()??"all";this.qobuzApi.getArtistDiscography(t,n,e?0:this.offset,this.PAGE_SIZE,this.currentSort()).subscribe({next:d=>{let l=d.items??[];e?this.albums.set(l):this.albums.update(V=>[...V,...l]),this.hasMore.set(l.length>=this.PAGE_SIZE),this.offset=e?this.PAGE_SIZE:this.offset+l.length,this.loading.set(!1),this.loadingMore.set(!1)},error:()=>{this.loading.set(!1),this.loadingMore.set(!1)}})}loadMore(){this.loadingMore()||!this.hasMore()||this.loadDiscography(!1)}goBack(){window.history.back()}setFilter(e){this.currentFilter()!==e&&(this.currentFilter.set(e),this.hasMore.set(!0),this.loadDiscography(!0))}onSortChange(e){let n=e.target.value;this.currentSort()!==n&&(this.currentSort.set(n),this.hasMore.set(!0),this.loadDiscography(!0))}getYear(e){return e?new Date(e*1e3).getFullYear().toString():""}playAlbum(e){e.id&&this.router.navigate(["/qobuz/album",e.id])}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=D({type:i,selectors:[["app-discography"]],inputs:{id:"id"},decls:18,vars:3,consts:[["scrollSentinel",""],[1,"discography-page","bg-bg-primary","min-h-screen","pb-28"],[1,"discography-page-header","flex","items-center","gap-4","p-4","mb-6"],[1,"discography-page-title-area","flex","flex-col","gap-0.5"],[1,"text-lg","sm:text-xl","font-bold","m-0","leading-tight"],[1,"discography-artist-subtitle","text-sm","text-text-secondary"],[1,"discography-controls","flex","justify-between","items-center","mb-5","gap-4","flex-wrap","px-4"],[1,"discography-filters","flex","gap-2","flex-wrap","flex-1","overflow-x-auto","scrollbar-hide","pb-1"],[1,"discography-filter-btn","flex-shrink-0","px-4","py-2","rounded-full","border","text-sm","font-medium","whitespace-nowrap","transition-colors",3,"bg-accent-qobuz","text-white","border-accent-qobuz","bg-transparent","text-text-secondary","border-border-accent","hover:bg-bg-card","hover:text-text-primary"],[1,"discography-sort","flex-shrink-0"],[1,"px-3","py-2","rounded-lg","bg-bg-card","border","border-border-accent","text-text-primary","text-sm","cursor-pointer","transition-colors","hover:border-accent-qobuz","focus:outline-none","focus:border-accent-qobuz","focus:ring-2","focus:ring-accent-qobuz/10",3,"change","value"],[3,"value"],[1,"px-4"],[1,"discography-page-grid","grid","grid-cols-2","sm:grid-cols-3","md:grid-cols-4","lg:grid-cols-5","gap-5"],[1,"empty-state","flex","flex-col","items-center","justify-center","py-16","text-text-muted"],[1,"discography-filter-btn","flex-shrink-0","px-4","py-2","rounded-full","border","text-sm","font-medium","whitespace-nowrap","transition-colors",3,"click"],[1,"skeleton-card","bg-bg-card","rounded-lg","overflow-hidden"],[1,"aspect-square","bg-bg-secondary","animate-pulse"],[1,"p-3"],[1,"h-4","bg-bg-secondary","rounded","animate-pulse","mb-2"],[1,"h-3","bg-bg-secondary","rounded","animate-pulse","w-2/3"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-12","h-12","mb-4","opacity-50"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","1","d","M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"],[1,"font-medium","mb-1"],[3,"album","showYear"],[1,"discography-loading","flex","flex-col","items-center","justify-center","gap-3","py-10","text-text-secondary","text-sm"],[1,"scroll-sentinel","h-px","w-full"],[3,"play","album","showYear"],[1,"loading-spinner-small","w-6","h-6","border-2","border-border-accent","border-t-accent-qobuz","rounded-full","animate-spin"]],template:function(t,n){t&1&&(r(0,"div",1)(1,"div",2)(2,"div",3)(3,"h1",4),c(4,"Diskografie"),o(),b(5,j,2,1,"span",5),o()(),r(6,"div",6)(7,"div",7),m(8,G,2,17,"button",8,N),o(),r(10,"div",9)(11,"select",10),y("change",function(l){return n.onSortChange(l)}),m(12,Y,2,2,"option",11,N),o()()(),r(14,"div",12),b(15,Q,3,1,"div",13)(16,Z,5,0,"div",14)(17,U,6,1),o()()),t&2&&(a(5),f(n.artistName()?5:-1),a(3),h(n.filters),a(3),v("value",n.currentSort()),a(),h(n.sortOptions),a(3),f(n.loading()&&n.albums().length===0?15:n.albums().length===0?16:17))},dependencies:[T,q],styles:[".scrollbar-hide[_ngcontent-%COMP%]{-ms-overflow-style:none;scrollbar-width:none}.scrollbar-hide[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.animate-spin[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin .8s linear infinite}@media(max-width:480px){.discography-page-header[_ngcontent-%COMP%]{flex-direction:row;align-items:center;gap:12px}.discography-page-title-area[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.25rem}.discography-controls[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.discography-sort[_ngcontent-%COMP%], .discography-sort[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%}.discography-page-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr);gap:12px}}.safe-area-top[_ngcontent-%COMP%]{padding-top:env(safe-area-inset-top,0)}"]})};export{R as DiscographyComponent};
