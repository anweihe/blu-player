import{a as P,c as q}from"./chunk-FWKO3KLK.js";import{d as z}from"./chunk-DFEYJVTO.js";import{b as A,d as T}from"./chunk-F3JCDRW3.js";import{Ja as O,Mb as I,R as b,Sa as f,Ta as v,Ua as D,Va as m,W as _,Wa as g,X as x,Xa as y,Y as C,Ya as r,Z as S,Za as o,_a as p,cb as M,eb as h,gb as u,ha as s,mb as E,ob as c,pb as w,qb as F,xa as a,xb as k}from"./chunk-F7VV2WDX.js";var L=()=>[1,2,3,4,5,6,7,8,9,10],N=(i,e)=>e.value,$=(i,e)=>e.id;function j(i,e){if(i&1&&(r(0,"span",8),c(1),o()),i&2){let t=u();a(),w(t.artistName())}}function B(i,e){if(i&1){let t=M();r(0,"button",18),h("click",function(){let d=_(t).$implicit,l=u();return x(l.setFilter(d.value))}),c(1),o()}if(i&2){let t=e.$implicit,n=u();E("bg-accent-qobuz",n.currentFilter()===t.value)("text-white",n.currentFilter()===t.value)("border-accent-qobuz",n.currentFilter()===t.value)("bg-transparent",n.currentFilter()!==t.value)("text-text-secondary",n.currentFilter()!==t.value)("border-border-accent",n.currentFilter()!==t.value)("hover:bg-bg-card",n.currentFilter()!==t.value)("hover:text-text-primary",n.currentFilter()!==t.value),a(),F(" ",t.label," ")}}function G(i,e){if(i&1&&(r(0,"option",14),c(1),o()),i&2){let t=e.$implicit;y("value",t.value),a(),w(t.label)}}function Q(i,e){i&1&&(r(0,"div",19),p(1,"div",20),r(2,"div",21),p(3,"div",22)(4,"div",23),o()())}function Y(i,e){i&1&&(r(0,"div",16),m(1,Q,5,0,"div",19,D),o()),i&2&&(a(),g(k(0,L)))}function Z(i,e){i&1&&(r(0,"div",17),C(),r(1,"svg",24),p(2,"path",25),o(),S(),r(3,"p",26),c(4,"Keine Ver\xF6ffentlichungen in dieser Kategorie"),o()())}function H(i,e){if(i&1){let t=M();r(0,"app-album-card",30),h("play",function(){let d=_(t).$implicit,l=u(2);return x(l.playAlbum(d))}),o()}if(i&2){let t=e.$implicit;y("album",t)("showYear",!0)}}function K(i,e){i&1&&(r(0,"div",28),p(1,"div",31),r(2,"span"),c(3,"Lade weitere Alben..."),o()())}function U(i,e){if(i&1&&(r(0,"div",16),m(1,H,1,2,"app-album-card",27,$),o(),f(3,K,4,0,"div",28),p(4,"div",29,0)),i&2){let t=u();a(),g(t.albums()),a(2),v(t.loadingMore()?3:-1)}}var J=[{value:null,label:"Alle"},{value:"album",label:"Alben"},{value:"epSingle",label:"EPs & Singles"},{value:"live",label:"Live"},{value:"compilation",label:"Compilations"},{value:"other",label:"Andere"}],W=[{value:"release_date",label:"Erscheinungsdatum"},{value:"relevant",label:"Beliebtheit"}];function X(i){return i?{single:"epSingle",ep:"epSingle","ep-single":"epSingle",ep_single:"epSingle",epSingle:"epSingle",album:"album",live:"live",compilation:"compilation",other:"other"}[i]??i:null}var R=class i{id;qobuzApi=b(P);route=b(A);router=b(T);loading=s(!0);loadingMore=s(!1);albums=s([]);artistName=s(void 0);artistImage=s(void 0);hasMore=s(!0);currentFilter=s(null);currentSort=s("release_date");filters=J;sortOptions=W;offset=0;PAGE_SIZE=20;scrollObserver=null;ngOnInit(){this.route.queryParams.subscribe(e=>{if(e.type){let t=X(e.type);this.currentFilter.set(t)}}),this.id&&(this.loadArtistInfo(),this.loadDiscography(!0)),setTimeout(()=>this.setupScrollObserver(),100)}ngOnDestroy(){this.cleanupScrollObserver()}setupScrollObserver(){let e=document.querySelector(".scroll-sentinel");e&&(this.cleanupScrollObserver(),this.scrollObserver=new IntersectionObserver(t=>{t[0].isIntersecting&&this.hasMore()&&!this.loadingMore()&&!this.loading()&&this.loadMore()},{rootMargin:"200px"}),this.scrollObserver.observe(e))}cleanupScrollObserver(){this.scrollObserver&&(this.scrollObserver.disconnect(),this.scrollObserver=null)}loadArtistInfo(){let e=parseInt(this.id,10);this.qobuzApi.getArtistPage(e).subscribe({next:t=>{this.artistName.set(t.name?.display),this.artistImage.set(z(t))}})}loadDiscography(e=!1){if(this.loadingMore()||!this.hasMore()&&!e)return;e?(this.loading.set(!0),this.offset=0):this.loadingMore.set(!0);let t=parseInt(this.id,10),n=this.currentFilter()??"all";this.qobuzApi.getArtistDiscography(t,n,e?0:this.offset,this.PAGE_SIZE,this.currentSort()).subscribe({next:d=>{let l=d.items??[];e?this.albums.set(l):this.albums.update(V=>[...V,...l]),this.hasMore.set(l.length>=this.PAGE_SIZE),this.offset=e?this.PAGE_SIZE:this.offset+l.length,this.loading.set(!1),this.loadingMore.set(!1)},error:()=>{this.loading.set(!1),this.loadingMore.set(!1)}})}loadMore(){this.loadingMore()||!this.hasMore()||this.loadDiscography(!1)}goBack(){window.history.back()}setFilter(e){this.currentFilter()!==e&&(this.currentFilter.set(e),this.hasMore.set(!0),this.loadDiscography(!0))}onSortChange(e){let n=e.target.value;this.currentSort()!==n&&(this.currentSort.set(n),this.hasMore.set(!0),this.loadDiscography(!0))}getYear(e){return e?new Date(e*1e3).getFullYear().toString():""}playAlbum(e){e.id&&this.router.navigate(["/qobuz/album",e.id])}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=O({type:i,selectors:[["app-discography"]],inputs:{id:"id"},decls:23,vars:3,consts:[["scrollSentinel",""],[1,"discography-page","bg-bg-primary","min-h-screen","pb-28"],[1,"discography-page-header","flex","items-center","gap-4","p-4","mb-6"],[1,"btn-back","flex","items-center","gap-2","text-text-secondary","hover:text-text-primary","transition-colors",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","d","M19 12H5M12 19l-7-7 7-7"],[1,"discography-page-title-area","flex","flex-col","gap-0.5"],[1,"text-xl","font-bold","m-0","leading-tight"],[1,"discography-artist-subtitle","text-sm","text-text-secondary"],[1,"discography-controls","flex","justify-between","items-center","mb-5","gap-4","flex-wrap","px-4"],[1,"discography-filters","flex","gap-2","flex-wrap","flex-1","overflow-x-auto","scrollbar-hide","pb-1"],[1,"discography-filter-btn","flex-shrink-0","px-4","py-2","rounded-full","border","text-sm","font-medium","whitespace-nowrap","transition-colors",3,"bg-accent-qobuz","text-white","border-accent-qobuz","bg-transparent","text-text-secondary","border-border-accent","hover:bg-bg-card","hover:text-text-primary"],[1,"discography-sort","flex-shrink-0"],[1,"px-3","py-2","rounded-lg","bg-bg-card","border","border-border-accent","text-text-primary","text-sm","cursor-pointer","transition-colors","hover:border-accent-qobuz","focus:outline-none","focus:border-accent-qobuz","focus:ring-2","focus:ring-accent-qobuz/10",3,"change","value"],[3,"value"],[1,"px-4"],[1,"discography-page-grid","grid","grid-cols-2","sm:grid-cols-3","md:grid-cols-4","lg:grid-cols-5","gap-5"],[1,"empty-state","flex","flex-col","items-center","justify-center","py-16","text-text-muted"],[1,"discography-filter-btn","flex-shrink-0","px-4","py-2","rounded-full","border","text-sm","font-medium","whitespace-nowrap","transition-colors",3,"click"],[1,"skeleton-card","bg-bg-card","rounded-lg","overflow-hidden"],[1,"aspect-square","bg-bg-secondary","animate-pulse"],[1,"p-3"],[1,"h-4","bg-bg-secondary","rounded","animate-pulse","mb-2"],[1,"h-3","bg-bg-secondary","rounded","animate-pulse","w-2/3"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-12","h-12","mb-4","opacity-50"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","1","d","M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"],[1,"font-medium","mb-1"],[3,"album","showYear"],[1,"discography-loading","flex","flex-col","items-center","justify-center","gap-3","py-10","text-text-secondary","text-sm"],[1,"scroll-sentinel","h-px","w-full"],[3,"play","album","showYear"],[1,"loading-spinner-small","w-6","h-6","border-2","border-border-accent","border-t-accent-qobuz","rounded-full","animate-spin"]],template:function(t,n){t&1&&(r(0,"div",1)(1,"div",2)(2,"button",3),h("click",function(){return n.goBack()}),C(),r(3,"svg",4),p(4,"path",5),o(),S(),r(5,"span"),c(6,"Zur\xFCck"),o()(),r(7,"div",6)(8,"h1",7),c(9,"Diskografie"),o(),f(10,j,2,1,"span",8),o()(),r(11,"div",9)(12,"div",10),m(13,B,2,17,"button",11,N),o(),r(15,"div",12)(16,"select",13),h("change",function(l){return n.onSortChange(l)}),m(17,G,2,2,"option",14,N),o()()(),r(19,"div",15),f(20,Y,3,1,"div",16)(21,Z,5,0,"div",17)(22,U,6,1),o()()),t&2&&(a(10),v(n.artistName()?10:-1),a(3),g(n.filters),a(3),y("value",n.currentSort()),a(),g(n.sortOptions),a(3),v(n.loading()&&n.albums().length===0?20:n.albums().length===0?21:22))},dependencies:[I,q],styles:[".scrollbar-hide[_ngcontent-%COMP%]{-ms-overflow-style:none;scrollbar-width:none}.scrollbar-hide[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.animate-spin[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin .8s linear infinite}@media(max-width:480px){.discography-page-header[_ngcontent-%COMP%]{flex-direction:row;align-items:center;gap:12px}.discography-page-title-area[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.25rem}.discography-controls[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.discography-sort[_ngcontent-%COMP%], .discography-sort[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%}.discography-page-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr);gap:12px}}"]})};export{R as DiscographyComponent};
